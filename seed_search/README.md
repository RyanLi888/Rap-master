# RAPIER 种子搜索模块 (高级版)

支持多层种子配置搜索的高级工具，能够优化RAPIER系统中所有模块的随机种子配置。

## 🎯 核心功能

- ✅ **全局种子搜索**: 搜索最优的全局种子
- ✅ **模块种子搜索**: 分别优化各模块的种子配置
- ✅ **局部优化搜索**: 在最佳配置周围进行精细搜索
- ✅ **配置管理**: 自动保存和恢复最佳配置
- ✅ **历史记录**: 完整的搜索历史管理

## 🧠 种子配置层次

RAPIER系统使用分层种子配置：

```python
RANDOM_CONFIG = {
    'global_seed': 2024,      # 全局种子 (影响整体随机性)
    'ae_seed': 290984,        # AE模块种子 (影响特征提取)
    'made_seed': 290713,      # MADE模块种子 (影响数据清理)
    'classifier_seed': 19616, # 分类器种子 (影响分类训练)
    'generation_seed': 61592  # 生成器种子 (影响GAN生成)
}
```

### 种子影响范围

| 种子类型 | 影响模块 | 作用范围 |
|---------|----------|----------|
| **global_seed** | 全局 | 整体随机性控制 |
| **ae_seed** | AE | 特征提取过程的随机性 |
| **made_seed** | MADE | 数据清理和标签修正 |
| **classifier_seed** | Classifier | 分类器训练和数据打乱 |
| **generation_seed** | MADE.generate_GAN | GAN对抗样本生成 |

## 📁 文件结构

```
seed_search/
├── global_seed_search.py         # 全局种子搜索器 (简单快速)
├── module_independent_search.py  # 模块独立搜索器 (推荐)
├── advanced_seed_search.py      # 高级种子搜索器 (组合搜索)
└── README.md                    # 使用文档
```

## 🚀 使用方法

### 0. 全局种子搜索 (⚡ 最简单快速)

**适合快速验证和初步优化！** 只改变全局种子，其他种子保持原有配置：

```bash
# 快速全局搜索 (5个常用种子)
python global_seed_search.py --strategy quick

# 全面全局搜索 (10个种子)  
python global_seed_search.py --strategy comprehensive

# 广泛全局搜索 (20个种子)
python global_seed_search.py --strategy extensive

# 聚焦搜索 (2020-2030年范围)
python global_seed_search.py --strategy focused

# 自定义全局种子搜索
python global_seed_search.py --seeds 42 123 1234 2024 7271

# 查看种子配置
python global_seed_search.py --config 2024
```

**优势**:
- ✅ **最简单**: 只需指定全局种子
- ✅ **最快速**: 每个种子3-5分钟
- ✅ **独立性**: 其他种子保持原有配置
- ✅ **易理解**: 只改变全局种子

### 1. 模块独立搜索 (🌟 推荐方法)

**这是最高效的搜索方法！** 独立搜索每个模块的最优种子，然后组合：

```bash
# 快速模块搜索 (每个模块测试3个种子)
python module_independent_search.py --strategy quick

# 全面模块搜索 (每个模块测试5个种子)  
python module_independent_search.py --strategy comprehensive

# 广泛模块搜索 (每个模块测试7个种子)
python module_independent_search.py --strategy extensive

# 自定义全局种子搜索
python module_independent_search.py --custom 2024 2025 2026
```

**优势**:
- ✅ **搜索效率高**: 只需测试 3×3×3×3×3 = 243 种组合 (vs 传统方法的数千种)
- ✅ **结果更优**: 每个模块都找到最优种子
- ✅ **时间可控**: 快速策略约2-3小时，全面策略约4-6小时
- ✅ **易于理解**: 清楚知道每个模块的最优配置

### 2. 组合种子搜索 (传统方法)

```bash
# 快速搜索 (5个常用种子)
python advanced_seed_search.py --mode global --strategy quick

# 全面搜索 (10个候选种子)  
python advanced_seed_search.py --mode global --strategy comprehensive

# 自定义种子搜索
python advanced_seed_search.py --mode global --seeds 42 123 1234 2024 7271
```

### 2. 模块种子搜索 (高级用法)

```bash
# 在最优全局种子基础上搜索各模块的最佳种子
python advanced_seed_search.py --mode module --strategy module_specific
```

这会测试以下组合：
- 基础全局种子: 2024
- AE种子候选: [290000, 290500, 291000, 291500]
- MADE种子候选: [290000, 290500, 291000, 291500]  
- 分类器种子候选: [19000, 19500, 20000, 20500]
- 生成器种子候选: [61000, 61500, 62000, 62500]

总共: 4×4×4×4 = **256种组合**

### 3. 局部优化搜索 (精细调优)

```bash
# 在当前最佳配置周围生成20个随机变体
python advanced_seed_search.py --mode local --variants 20 --radius 1000
```

### 4. 查看结果

```bash
# 查看最佳配置
python advanced_seed_search.py --best

# 查看搜索历史
python advanced_seed_search.py --history
```

## 📊 搜索策略对比

| 策略 | 工具 | 测试数量 | 时间估计 | 适用场景 |
|------|------|----------|----------|----------|
| **全局种子搜索** | global_seed | 5-20个 | 15分钟-2小时 | ⚡ **最简单快速** |
| **模块独立搜索** | module_independent | 243个 | 2-3小时 | 🌟 **推荐方法** |
| **模块独立全面** | module_independent | 3125个 | 4-6小时 | 深度优化 |
| **组合搜索** | advanced_seed | 256个 | 12-20小时 | 传统方法 |
| **局部优化** | advanced_seed | 20个 | 1-2小时 | 精细调优 |

## 🎯 推荐使用流程

### ⚡ 快速入门 (全局种子搜索)
1. **快速全局搜索**: `python global_seed_search.py --strategy quick`
2. **查看结果**: `python global_seed_search.py --best`
3. **如果满意**: 使用最佳配置
4. **如果不满意**: 进行模块独立搜索

### 🌟 最佳实践 (模块独立搜索)
1. **快速模块搜索**: `python module_independent_search.py --strategy quick`
2. **查看结果**: `python module_independent_search.py --best`
3. **如果满意**: 使用最佳配置
4. **如果不满意**: 进行全面模块搜索

### 传统方法 (组合搜索)
1. **快速搜索**: `python advanced_seed_search.py --mode global --strategy quick`
2. **模块搜索**: `python advanced_seed_search.py --mode module --strategy module_specific`
3. **局部优化**: `python advanced_seed_search.py --mode local --variants 50`

### 日常维护
1. **查看历史**: `python global_seed_search.py --history`
2. **验证最佳**: `python global_seed_search.py --best`

## 📈 输出示例

### 全局种子搜索 (最简单快速)

```
🌍 RAPIER 全局种子搜索器
==================================================
📊 候选全局种子: [42, 123, 1234, 2024, 7271]
🔢 总共需要测试: 5 个种子

进度: 1/5
🔍 测试全局种子: 42 (其他种子保持原有配置)
✅ 全局种子 42: F1=0.7650, 用时=185.3s

进度: 2/5
🔍 测试全局种子: 123 (其他种子保持原有配置)
✅ 全局种子 123: F1=0.7720, 用时=178.9s
🎉 发现新的最佳全局种子: 123 (F1=0.7720)

进度: 3/5
🔍 测试全局种子: 1234 (其他种子保持原有配置)
✅ 全局种子 1234: F1=0.7680, 用时=182.1s

进度: 4/5
🔍 测试全局种子: 2024 (其他种子保持原有配置)
✅ 全局种子 2024: F1=0.7911, 用时=179.8s
🎉 发现新的最佳全局种子: 2024 (F1=0.7911)

进度: 5/5
🔍 测试全局种子: 7271 (其他种子保持原有配置)
✅ 全局种子 7271: F1=0.7850, 用时=181.5s

📊 全局种子搜索结果摘要
============================================================
✅ 成功测试: 5/5 个种子
🏆 最佳全局种子: 2024
🎯 最佳F1分数: 0.7911

📈 前5名结果:
排名 全局种子 F1分数  用时(秒)
-----------------------------------
1    2024     0.7911   179.8
2    7271     0.7850   181.5
3    123      0.7720   178.9
4    1234     0.7680   182.1
5    42       0.7650   185.3
```

### 模块独立搜索 (推荐)

```
🧠 RAPIER 模块独立种子搜索器
==================================================
📋 使用策略: 快速搜索 - 每个模块测试3个种子

🔍 搜索 全局种子 的最优种子...
----------------------------------------
🔍 测试配置: 全局种子_seed_2024 - G2024_A290984_M290713_C19616_Gen61592
✅ 全局种子_seed_2024: F1=0.7911, 用时=182.3s
🎉 发现更好的种子: 2024 (F1=0.7911)

🔍 测试配置: 全局种子_seed_2025 - G2025_A290984_M290713_C19616_Gen61592
✅ 全局种子_seed_2025: F1=0.7850, 用时=179.8s

🔍 测试配置: 全局种子_seed_2026 - G2026_A290984_M290713_C19616_Gen61592
✅ 全局种子_seed_2026: F1=0.7780, 用时=181.2s

✅ 全局种子 搜索完成:
   最佳种子: 2024
   最佳F1: 0.7911
   测试数量: 3

🔍 搜索 AE模块 的最优种子...
----------------------------------------
🔍 测试配置: AE模块_seed_290000 - G2024_A290000_M290713_C19616_Gen61592
✅ AE模块_seed_290000: F1=0.7890, 用时=180.5s

🔍 测试配置: AE模块_seed_290500 - G2024_A290500_M290713_C19616_Gen61592
✅ AE模块_seed_290500: F1=0.7920, 用时=179.3s
🎉 发现更好的种子: 290500 (F1=0.7920)

🔍 测试配置: AE模块_seed_291000 - G2024_A291000_M290713_C19616_Gen61592
✅ AE模块_seed_291000: F1=0.7880, 用时=181.1s

✅ AE模块 搜索完成:
   最佳种子: 290500
   最佳F1: 0.7920
   测试数量: 3

🔗 组合各模块最优种子...
----------------------------------------
🧪 验证组合配置效果...
🔍 测试配置: 组合最优配置 - G2024_A290500_M290750_C19750_Gen61750
✅ 组合最优配置: F1=0.7945, 用时=182.7s
🎉 发现新的全局最佳配置: F1=0.7945

📊 模块独立搜索结果
============================================================
模块         最佳种子    最佳F1    测试数量
--------------------------------------------------
全局种子     2024       0.7911    3
AE模块       290500     0.7920    3
MADE模块     290750     0.7895    3
分类器模块   19750      0.7900    3
生成器模块   61750      0.7885    3

🔗 组合配置:
   全局种子: 2024
   AE种子: 290500
   MADE种子: 290750
   分类器种子: 19750
   生成器种子: 61750
   组合F1: 0.7945
```

### 全局种子搜索 (传统方法)

```
🧠 RAPIER 高级种子搜索器
==================================================
🔍 全局种子搜索模式
📊 候选种子: [42, 123, 1234, 2024, 7271]
📋 使用策略: 快速搜索 - 测试5个常用全局种子

🔍 测试种子配置: G42_A57754_M58758_C65267_Gen67364
✅ 配置 G42_A57754_M58758_C65267_Gen67364: F1=0.7650, 用时=185.3s

🔍 测试种子配置: G123_A19851_M19137_C21327_Gen22873
✅ 配置 G123_A19851_M19137_C21327_Gen22873: F1=0.7720, 用时=178.9s

🎉 发现新的最佳配置: F1=0.7720

🔍 测试种子配置: G2024_A279288_M282336_C305576_Gen309424
✅ 配置 G2024_A279288_M282336_C305576_Gen309424: F1=0.7911, 用时=182.1s

🎉 发现新的最佳配置: F1=0.7911
```

### 查看最佳配置

```
🏆 最佳种子配置:
   全局种子: 2024
   AE种子: 279288
   MADE种子: 282336
   分类器种子: 305576
   生成器种子: 309424
   F1分数: 0.7911
   时间: 2025-09-21 18:30:15
```

## ⚠️ 重要说明

### 搜索时间
- **全局搜索**: 每个种子3-5分钟
- **模块搜索**: 可能需要数小时到一天
- **局部搜索**: 1-2小时

### 资源需求
- **存储**: 每次测试约500MB临时空间
- **内存**: 建议至少8GB
- **GPU**: 需要CUDA支持

### 最佳实践
1. **从全局搜索开始**: 先找到好的全局种子
2. **逐步深入**: 再进行模块级优化
3. **监控进度**: 定期检查中间结果
4. **备份重要结果**: 保存关键配置

## 🔧 自定义搜索

### 修改搜索范围

编辑 `advanced_seed_search.py` 中的 `SEARCH_STRATEGIES`:

```python
'custom_strategy': {
    'base_global_seed': 2024,
    'module_ranges': {
        'ae_seed': [290000, 295000, 300000],
        'made_seed': [290000, 295000, 300000],
        'classifier_seed': [19000, 20000, 21000],
        'generation_seed': [61000, 62000, 63000]
    }
}
```

### 添加新的搜索模式

可以在类中添加新的搜索方法，例如：
- 遗传算法搜索
- 贝叶斯优化搜索
- 网格搜索

---

**版本**: 3.0 (高级版)  
**更新时间**: 2025年9月21日  
**功能**: 多层种子配置搜索